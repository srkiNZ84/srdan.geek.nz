<!doctype html><html lang=en><head><title>Creating SSHFP records · Home of Srđan Đukić</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta http-equiv=Content-Security-Policy content="upgrade-insecure-requests; block-all-mixed-content; default-src 'self'; child-src 'self'; font-src 'self' https://fonts.gstatic.com https://cdn.jsdelivr.net/; form-action 'self'; frame-src 'self' https://disqus.com; img-src 'self' https://www.gravatar.com https://referrer.disqus.com https://c.disquscdn.com https://cdn.viglink.com; object-src 'none'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com/ https://cdn.jsdelivr.net/ https://c.disquscdn.com; script-src 'self' 'unsafe-inline' https://www.google-analytics.com https://srdan-geek-nz.disqus.com https://c.disquscdn.com; connect-src 'self' https://www.google-analytics.com https://links.services.disqus.com;"><meta name=author content="Srđan Đukić"><meta name=description content="How to setup SSHFP records to verify SSH fingerprints through DNS"><meta name=keywords content="blog,developer,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content="Creating SSHFP records"><meta name=twitter:description content="How to setup SSHFP records to verify SSH fingerprints through DNS"><meta property="og:url" content="https://srdan.geek.nz/posts/monday-1st-february-22/"><meta property="og:site_name" content="Home of Srđan Đukić"><meta property="og:title" content="Creating SSHFP records"><meta property="og:description" content="How to setup SSHFP records to verify SSH fingerprints through DNS"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-02-01T11:32:46+13:00"><meta property="article:modified_time" content="2022-02-01T11:32:46+13:00"><meta property="article:tag" content="Ssh"><meta property="article:tag" content="Fingerprint"><meta property="article:tag" content="Verification"><meta property="article:tag" content="Authentication"><link rel=canonical href=https://srdan.geek.nz/posts/monday-1st-february-22/><link rel=preload href=/fonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/coder.min.022594d625780e2edf64581b893d32cb35c11de5d88953ea4ad3c2e45451e214.css integrity="sha256-AiWU1iV4Di7fZFgbiT0yyzXBHeXYiVPqStPC5FRR4hQ=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.a00e6364bacbc8266ad1cc81230774a1397198f8cfb7bcba29b7d6fcb54ce57f.css integrity="sha256-oA5jZLrLyCZq0cyBIwd0oTlxmPjPt7y6KbfW/LVM5X8=" crossorigin=anonymous media=screen><link rel=icon type=image/svg+xml href=/images/favicon.svg sizes=any><link rel=icon type=image/png href=/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/images/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/images/safari-pinned-tab.svg color=#5bbad5></head><body class="preload-transitions colorscheme-auto"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=https://srdan.geek.nz/>Home of Srđan Đukić
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa-solid fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/about/>About</a></li><li class=navigation-item><a class=navigation-link href=/posts/>Blog</a></li><li class=navigation-item><a class=navigation-link href=/projects/>Projects</a></li><li class=navigation-item><a class=navigation-link href=/contact/>Contact me</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://srdan.geek.nz/posts/monday-1st-february-22/>Creating SSHFP records</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa-solid fa-calendar" aria-hidden=true></i>
<time datetime=2022-02-01T11:32:46+13:00>February 1, 2022
</time></span><span class=reading-time><i class="fa-solid fa-clock" aria-hidden=true></i>
4-minute read</span></div><div class=authors><i class="fa-solid fa-user" aria-hidden=true></i>
<a href=/authors/sr%C4%91an-%C4%91uki%C4%87/>Srđan Đukić</a></div><div class=tags><i class="fa-solid fa-tag" aria-hidden=true></i>
<span class=tag><a href=/tags/ssh/>Ssh</a>
</span><span class=separator>•</span>
<span class=tag><a href=/tags/fingerprint/>Fingerprint</a>
</span><span class=separator>•</span>
<span class=tag><a href=/tags/verification/>Verification</a>
</span><span class=separator>•</span>
<span class=tag><a href=/tags/authentication/>Authentication</a></span></div></div></header><div class=post-content><h1 id=how-to-setup-sshfp-records-to-verify-ssh-fingerprints>How to setup SSHFP records to verify SSH fingerprints
<a class=heading-link href=#how-to-setup-sshfp-records-to-verify-ssh-fingerprints><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h1><h2 id=what-are-sshfp-records-and-what-problem-are-we-trying-to-solve>What are SSHFP records and what problem are we trying to solve?
<a class=heading-link href=#what-are-sshfp-records-and-what-problem-are-we-trying-to-solve><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>NOTE: Feel free to skip this part if you know what <a href=https://en.wikipedia.com/wiki/SSHFP_record class=external-link target=_blank rel=noopener>SSHFP records</a> are and want to get to the instructions</p><p>So, you might have noticed that every time you connect to a server over SSH you get a message like this:</p><p><img src=../../static/ssh_fingerprint.png alt="ssh connection fingerprint prompt"></p><p>The reasons for the message is that, unlike the CA system, the SSH protocol doesn&rsquo;t have a centralised &ldquo;root of trust&rdquo;
that forms the basis of authentication i.e. you have to figure out if the server you&rsquo;re talking to is actually the
server you&rsquo;re wanting to talk to.</p><p>What this means from a practical perspective is that the first time you connect to a server you need to check the hash
of it&rsquo;s public key to ensure that it is in fact the right server and not a .comery.</p><p>The general way to do this is to have a separate &ldquo;channel&rdquo; (e.g. email, secure chat, <a href=https://en.wikipedia.com/wiki/Sneakernet class=external-link target=_blank rel=noopener>sneaker
net</a> etc&mldr;) that you receive the &ldquo;trusted&rdquo; public key fingerprint on.</p><p>The main issue with this is that there is a tendency to &ldquo;click through&rdquo; the message and just accept whatever hash is
there in the same way that certificate warnings inadvertently &ldquo;trained&rdquo; users for a long time to click through warnings.</p><p>SSHFP solves this problem by getting the SSH client to verify the hash presented by the server by comparing it to a DNS
record of the host of the SSHFP type.</p><p>NOTE: The DNS records themselves should be signed and verified using
<a href=https://en.wikipedia.com/wiki/Domain_Name_System_Security_Extensions class=external-link target=_blank rel=noopener>DNSSEC</a> which we will leave for another article</p><h2 id=how-to-setup-sshfp-records>How to setup SSHFP records
<a class=heading-link href=#how-to-setup-sshfp-records><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>Generating the records is fairly straight forward as it is built into the ssh-keygen command. It&rsquo;s simple enough to do
with the <code>-r</code> flag:</p><pre tabindex=0><code># ssh-keygen -r examplehost.example.com
</code></pre><p>This should generate output such as below:</p><pre tabindex=0><code>examplehost.example.com IN SSHFP 1 1 1bd1755b811ba9c9a4416400e7b379d403ca8d11
examplehost.example.com IN SSHFP 1 2 54ec99231d0cf174e0d36c4ee691d55ec65c31c754e4348250d4162c148bde82
examplehost.example.com IN SSHFP 3 1 d926ddf5ecbfbcc7dca7d8b6b0fc4c5002c6d60a
examplehost.example.com IN SSHFP 3 2 407f3924ad32abe24d97594f2949718adf9d185a96312fcc9a885c20da7f7bd4
examplehost.example.com IN SSHFP 4 1 8d66e7ef5340329337e58e576c54468dd6246c99
examplehost.example.com IN SSHFP 4 2 591f54c3864c4509e4734651ed45365cecdec28a1edc6866212fdfac0fa83b4f
</code></pre><p>There are several records based on the fact that we want to represent the key using several algorithms (currently
supported are RSA, DSA, ECDSA,
Ed25519, Ed448) as well as the type of hash that was used (at the moment either SHA-1 or SHA-256)</p><p>Once we have these in place, we can then verify with:</p><pre tabindex=0><code>$ dig SSHFP examplehost.example.com +short
1 1 A815236B92692195D9C34401CE9AC69837EA0470
4 1 284D04634247D0DEF54DA1A914F8C6636D834742
2 2 6689E96571F8E9BF70BAADECA51AA21323C493ED3243689D5CA2E9FC 5E728E6F
3 1 D06FB9244C6D5147CC13A14911637B975E70B07C
2 1 CFABAD89413AF3763836E71B1865DD6F374CC95A
1 2 C2A1562C4AC63A946D42373DEC440BF79F9220B8B383C28D5E2E7429 22374B17
3 2 0FCB57E5971EA68174431840F4A74261A25B016A22FD00E60EF99797 0DC1EBD4
4 2 DC2C591C620C9AB5652A863229E1726B39E6835C5CDAA8990F7D3096 584ACC90
</code></pre><p>after which we need to configure our SSH client to use DNS to verify the fingerprint by adding the following line to our
&lsquo;.ssh/config&rsquo; file:</p><pre tabindex=0><code>VerifyHostKeyDNS yes
</code></pre><p>After adding this line, when connecting now we should see the following message when we connect to our host:</p><pre tabindex=0><code>$ ssh foobar@examplehost.example.com
The authenticity of host &#39;examplehost.example.com (51.3.101.161)&#39; can&#39;t be established.
ED25519 key fingerprint is SHA256:3CxZHGIMlrPlKoYyKeFyaznmg1xj2qiZD30wllhKzJA.
Matching host key fingerprint found in DNS.
Are you sure you want to continue connecting (yes/no/[fingerprint])?
</code></pre><p>As we can see, we are now informed by the SSH client that a matching host key was found in DNS, meaning that the
computer has compared the hashes for us!</p><p>If someone tries to trick us into connecting to the wrong server, we will get the following error message:</p><pre tabindex=0><code>$ ssh foobar@examplehost.example.com
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@    WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!     @
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
IT IS POSSIBLE THAT SOMEONE IS DOING SOMETHING NASTY!
Someone could be eavesdropping on you right now (man-in-the-middle attack)!
It is also possible that a host key has just been changed.
The fingerprint for the ED25519 key sent by the remote host is
SHA256:4udrktMzBVyoVYxZjDK9dL5i72golv7RB4Mj7DnIU74.
Please contact your system administrator.
Update the SSHFP RR in DNS with the new host key to get rid of this message.
The authenticity of host &#39;examplehost.example.com (51.3.101.161)&#39; can&#39;t be established.
ED25519 key fingerprint is SHA256:4udrktMzBVyoVYxZjDK9dL5i72golv7RB4Mj7DnIU74.
No matching host key fingerprint found in DNS.
Are you sure you want to continue connecting (yes/no/[fingerprint])?
</code></pre><p>Do note that the client still prompts us and gives us the ability to accept the fingerprint and connect. However, it is
explicit in saying that the DNS does not match.</p></div><footer><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//srdan-geek-nz.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}(),document.addEventListener("themeChanged",function(){document.readyState=="complete"&&DISQUS.reset({reload:!0,config:disqus_config})})</script></footer></article></section></div><footer class=footer><section class=container>©
2019 -
2025
Srđan Đukić
·
Powered by <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/ target=_blank rel=noopener>Coder</a>.</section></footer></main><script src=/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script></body></html>